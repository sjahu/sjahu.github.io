<!doctype html>
<html lang="en">

<head>
  <title>Simulating an Oregon Scientific v2.1 remote temperature sensor | Stephen's Site</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/assets/css/style.css">
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/blog/feed.xml">
</head>

<body>
  <div id="default-container">
    <div id="default-header">
      
      <nav>
        <a href="/">Home</a>
        <a href="/blog">Blog</a>
      </nav>
      
    </div>

    <div id="default-content">
      <h1 class="post-title">Simulating an Oregon Scientific v2.1 remote temperature sensor</h1>
<div class="post-publish-date">Published Sunday, December 04, 2022</div>

<figure class="post-header-image">
  <img src="/assets/images/blog/2022-12-04/prototype.jpg">
  
</figure>

<section class="post-content">
  <p>I have a digital clock, made by Oregon Scientific, that displays temperature and humidity readings transmitted to it by a sensor that lives outside. The receiver has held up well over the 17 or 18 years I’ve had it, but I’ve had to replace the remote sensor, constantly exposed to the elements as it is, several times.</p>

<figure>
  <img src="/assets/images/blog/2022-12-04/bar608hga_manual.png" />
  <figcaption><a href="https://archive.org/details/generalmanual_000074498">BAR608HGA and THGR122NX manual, c. 2004 (PDF)</a></figcaption>
</figure>

<p>Years ago, the specific sensor model compatible with my base station was easy to buy and not too expensive. Now, though, it’s hard to find at a price justifiable for such an old clock, if at all. When I bought the last replacement in 2018, it cost $55 on Amazon (I could buy a whole new weather station for about that price, but what a waste). At least it was available. Today, I can only find one eBay listing for a well-used, untested, $95 sensor, and <a href="https://weatherspares.co.uk/collections/oregon-scientific-sensors-options">this neat British shop</a>, which at time of writing lists a couple compatible <em>new</em> sensors as “back soon”. Even if they were in stock, once shipping to Canada and duties were factored in, a replacement sensor would cost over $100.</p>

<p>Thus, before the sensor I have stops working, I wanted to characterize the signal it transmits and figure out how to reproduce it. I thought it would be <em>far</em> easier to do so while I still had a reference sensor to compare to.</p>

<p>I did some poking around on the Internet and found that there’s actually quite a large body of knowledge on the protocols used by remote weather sensors– it seems like a lot of people buy them separately to use with custom-built Arduino, Raspberry Pi, or PC-based receivers. The most complete (and most frequently referenced) source of information I found is <a href="https://www.osengr.org/WxShield/Web/WxShield.shtml">osengr.org</a>, home to an open-source Arduino-based receiver that supports a wide range of sensors from various manufacturers. <a href="https://www.osengr.org/Articles/OS-RF-Protocols-IV.pdf">This 45-page PDF</a> (also rehosted <a href="/assets/pdf/blog/2022-12-04/OS-RF-Protocols-IV.pdf">here</a>) is the fourth in a series of successively more expansive documents comprehensively describing all kinds of weather sensor protocols, including the one used by the THGR122NX sensor my base station came with. Kudos and many thanks to the author.</p>

<p>Armed with a <a href="https://www.aliexpress.com/item/32980820915.html">433 MHz transmitter</a> and <a href="https://www.aliexpress.com/item/32523611214.html">DHT-22</a> temperature/humidity sensor from AliExpress and an Arduino, I set about naïvely implementing a clone of my sensor based purely on my interpretation of the description of the Oregon Scientific v2.1 RF protocol from the PDF. Perhaps inevitably, it didn’t work (does implementing something right from the spec <em>ever</em> work on the first try?).</p>

<p>To debug my failed transmission attempt, I needed some way to record the signal and compare it to the one transmitted by the real sensor. Here is a photo of me at the moment I came to that realization:</p>

<p><img src="/assets/images/blog/2022-12-04/i_have_no_idea_what_im_doing.jpg" class="medium" /></p>

<p>I did some reading and found out that what I needed was called a <em>logic analyzer</em>, which is like an oscilloscope, but for digital signals and capable of recording signals over time. At the recommendation of <a href="https://www.youtube.com/watch?v=dobU-b0_L1I">this video introduction</a> to logic analyzers and <a href="https://sigrok.org/">Sigrok</a>, an open-source signal analysis software suite including a GUI called <a href="https://sigrok.org/wiki/PulseView">PulseView</a>, I bought a <a href="https://www.amazon.ca/gp/product/B08P1DW2PM/">$20 USB logic analyzer</a> from Amazon (also available for like $6 on AliExpress, but I was impatient). The analyzer, which is a Chinese clone of a discontinued professional-grade tool made by <a href="https://www.saleae.com/">Saleae</a>, supports 8 channels and can capture 24 million samples per second. The fact that such a useful tool is available for so cheap boggles my mind– what a time to be alive.</p>

<p>I plugged a 433 MHz receiver into one of the leads of the logic analyzer and captured some recordings of transmissions from the real sensor. I had expected to have to do a lot of squinting at square waves and pencil/paper work to decode the signal, but while looking through the menu of built-in decoders for one that could take some of the work out of reading the <a href="https://en.wikipedia.org/wiki/Manchester_code">Manchester</a>-encoded signal, I discovered that not only did the built-in On-Off Keying decoder support decoding Manchester code, but that there was also <a href="https://sigrok.org/wiki/Protocol_decoder:Ook_oregon">a second-level decoder</a> specifically for the various Oregon Scientific protocols. What a time saver!</p>

<figure>
  <div style="max-width: 100%; overflow: scroll;">
    <img src="/assets/images/blog/2022-12-04/sigrok.png" style="max-width: none;" />
  </div>
  <figcaption>
    A recording of a THGR122NX data frame captured with Sigrok (scroll right).
  </figcaption>
</figure>

<p>After much trial and error, I came up with the following protocol description and a working prototype.</p>

<h1 id="thgr122nx-protocol-description">THGR122NX protocol description</h1>

<p>The osengr PDF promises “descriptions … sufficient for those building maker projects to receive and decode these signals”; based on my experimentation, here’s a full description of the Oregon Scientific v2.1 protocol as implemented by the THGR122NX sensor, sufficient for <em>transmitting</em> a signal that will be accepted by an original Oregon Scientific base station. Some information may be applicable to other sensors that implement the v2.1 protocol.</p>

<h2 id="carrier-wave-and-bit-encoding">Carrier wave and bit encoding</h2>
<p>Bits are transmitted at 1024 Hz using normal-mode Manchester coding on a 433.92 MHz carrier wave. The 433.92 MHz wave can be generated or demodulated into a simple digital signal by specialized hardware like the cheap transmitter and receiver pair linked above. Manchester code uses a transition at the middle of each clock cycle to indicate a bit value: in the normal mode, a <code class="language-plaintext highlighter-rouge">0</code> is encoded as off-on and a <code class="language-plaintext highlighter-rouge">1</code> as on-off (in the reversed mode, it’s the opposite). This graphic from Wikipedia shows how it works:</p>

<figure class="medium">
  <img src="/assets/images/blog/2022-12-04/manchester_encoding.svg" class="medium" />
  <figcaption><a href="https://en.wikipedia.org/wiki/Manchester_code#/media/File:Manchester_encoding_both_conventions.svg">Wikipedia</a></figcaption>
</figure>

<p>For protocol v2.1, each bit is sent twice, but inverted the first time. So, for example, the bit sequence <code class="language-plaintext highlighter-rouge">1011</code> is actually transmitted as <code class="language-plaintext highlighter-rouge">01100101</code>, which, in Manchester coding, becomes <code class="language-plaintext highlighter-rouge">off-on-on-off-on-off-off-on-off-on-on-off-off-on-on-off</code>, with each <code class="language-plaintext highlighter-rouge">on</code> or <code class="language-plaintext highlighter-rouge">off</code> state held for (1/1024)/2 seconds. The entire sequence is then repeated, after a short delay of 10.9 ms according to the PDF, or about 55 ms based on my observations. Since we both apparently used THGR122NX sensors, we can probably conclude that the specific length of the delay doesn’t matter.</p>

<p>As you can see from the example above, in this scheme, a transmission is composed of intervals where the signal is either <code class="language-plaintext highlighter-rouge">on</code> or <code class="language-plaintext highlighter-rouge">off</code> for either a long or short time (depending on whether adjacent half-cycles are the same state). In the PDF, the author describes a sensor which always cuts short the <code class="language-plaintext highlighter-rouge">on</code> pulses by a consistent amount. My sensor didn’t exhibit the same behaviour: rather, the duration of individual <code class="language-plaintext highlighter-rouge">on</code> and <code class="language-plaintext highlighter-rouge">off</code> pulses varied wildly, but the <em>average</em> clock rate was still almost precisely 1024 Hz.</p>

<p>The Oregon Scientific receiver is very picky about the clock rate of the signal; any more than a few microseconds off per cycle and it’ll ignore the transmission. I found that if I used Arduino’s <code class="language-plaintext highlighter-rouge">delayMicroseconds</code> function to pause for 488 μs between state changes, the resulting RF pulses were actually too long for the receiver. Thus, the nominal delay must be callibrated depending on the hardware generating the signal so that the real signal is clocked as closely as possible to 1024 Hz (976.5 μs per cycle). This is mentioned by readers in the comments on <a href="http://www.connectingstuff.net/blog/encodage-protocoles-oregon-scientific-sur-arduino/">this blog post</a>, in which the author, Olivier Lebrun, described a simulated v2.1 sensor that could be picked up by an aftermarket base station; as the commenters there and my experience can attest, the original base stations are pickier about timing.</p>

<h2 id="data-format">Data format</h2>

<p>V2.1 protocol data frames vary in length between sensor models. There are more details on other sensors in the osengr PDF; here’s the format of the data transmitted by my THGR122NX sensor.</p>

<p>Each frame is 96 bits long, divided into 24 nibbles. The nibbles are transmitted in order, with each one transmitted least-significant-bit-first; e.g. the nibble <code class="language-plaintext highlighter-rouge">0x8</code> (<code class="language-plaintext highlighter-rouge">1000</code> in binary) would be transmitted as <code class="language-plaintext highlighter-rouge">0</code>, <code class="language-plaintext highlighter-rouge">0</code>, <code class="language-plaintext highlighter-rouge">0</code>, <code class="language-plaintext highlighter-rouge">1</code>.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">0-3</code>: The first four nibbles are a pre-amble consisting of 16 <code class="language-plaintext highlighter-rouge">1</code> bits. Recall that each bit is transmitted twice, inverted first, so really this results in a transmission of <code class="language-plaintext highlighter-rouge">01010101010101010101010101010101</code>. This is used to alert the receiver that a message is incoming and to give its automatic gain control circuit a chance to callibrate itself to the signal strength. In theory, it also allows a receiver to recover the clock rate of the signal, but the Oregon Scientific base station doesn’t do that.</li>
  <li><code class="language-plaintext highlighter-rouge">4</code>: The sync nibble (<code class="language-plaintext highlighter-rouge">0xa</code>) identifies where the pre-amble ends and where the message payload begins.</li>
  <li><code class="language-plaintext highlighter-rouge">5-8</code>: The sensor ID, which varies between sensor models. For the THGR122NX and apparently some other functionally equivalent models, the ID is, in the order of transmission, <code class="language-plaintext highlighter-rouge">0x1</code>, <code class="language-plaintext highlighter-rouge">0xd</code>, <code class="language-plaintext highlighter-rouge">0x2</code>, <code class="language-plaintext highlighter-rouge">0x0</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">9</code>: The channel number, either 1, 2, or 3, but encoded as <code class="language-plaintext highlighter-rouge">0x1</code>, <code class="language-plaintext highlighter-rouge">0x2</code>, or <code class="language-plaintext highlighter-rouge">0x4</code> (i.e. the first, second, or third bit in the nibble).</li>
  <li><code class="language-plaintext highlighter-rouge">10-11</code>: The rolling ID, which is a random identifier generated when the batteries are inserted.</li>
  <li><code class="language-plaintext highlighter-rouge">12</code>: Flags. The battery-low flag is <code class="language-plaintext highlighter-rouge">0x4</code>. I also observed the <code class="language-plaintext highlighter-rouge">0x8</code> bit set far more often than not, regardless of the presence of the battery-low flag and regardless of the current temperature and humidity. It doesn’t appear to mean anything. The PDF mentions that one status bit might change between the first and second repetitions of the signal, but I did not observe that behaviour from my sensor.</li>
  <li><code class="language-plaintext highlighter-rouge">13-16</code>: The temperature in degrees Celcius, represented in binary-coded-decimal with the 0.1s first, then the ones, then the tens, then the hundreds. The largest bit of the fourth nibble represents the sign (<code class="language-plaintext highlighter-rouge">0x0</code> for positive and <code class="language-plaintext highlighter-rouge">0x8</code> for negative).</li>
  <li><code class="language-plaintext highlighter-rouge">17-18</code>: The relative humidity, with ones transmitted in the first nibble and tens in the second.</li>
  <li><code class="language-plaintext highlighter-rouge">19</code>: Always <code class="language-plaintext highlighter-rouge">0x8</code>, meaning unknown.</li>
  <li><code class="language-plaintext highlighter-rouge">20-21</code>: A checksum calculated by adding together all the nibbles from <code class="language-plaintext highlighter-rouge">5-19</code>, inclusive. Any time overflow occurs during this summation (i.e. the sum is greater than 255 or what fits in 1 byte), it’s added back into the result. Transmitted in LSB-first order.</li>
  <li><code class="language-plaintext highlighter-rouge">22-23</code>: A second checksum, calculated by the CRC-8-CCITT algorithm described in the PDF, but with an initial value of <code class="language-plaintext highlighter-rouge">0x42</code> and considering only nibbles <code class="language-plaintext highlighter-rouge">5-9</code> and <code class="language-plaintext highlighter-rouge">12-19</code>. Transmitted in LSB-first order.</li>
</ul>

<h3 id="crc">CRC</h3>

<p>More on the CRC (which stands for <em>cyclic redundancy check</em>)… I had got to a point where I could reliably replay signals captured from my real sensor and have them be picked up by the receiver, but I wasn’t yet able to transmit arbitrary data because I couldn’t generate a valid CRC. Part of implementing the CRC algorithm is picking an initial value for the result register. According to the PDF, version 3 sensors use an initial value of zero, and</p>

<blockquote>
  <p>Version 2.1 sensors appear to use different initial register values – even among sensors of the same model. It is not clear if this is actually correct – it seems a little odd to ask the receiver of these messages to figure out the correct initial register value. Perhaps there is a simpler explanation for the CRC algorithm used in version 2.1 sensors.</p>
</blockquote>

<p>In Olivier’s blog post, he didn’t address the CRC byte; transmitting two zero nibbles in its place was good enough since the aftermarket receiver he was targeting didn’t verify the secondary checksum anyway. One commenter provided an implementation of a function to generate the CRC, and a couple others indicated that they were able to get it to work with real base stations by using different initial values, which lines up with what the PDF said.</p>

<p>The initial value is just the value stored in the result register before any of the message bits have been fed into the algorithm. Knowing that there must be some way to deterministically calculate the CRC without having any advance knowledge about the specific sensor sending the message, I reset my sensor a bunch of times and recorded the subsequent transmissions to see if I could figure out the pattern. Since there are only 255 possible values for the IV, it’s trivial to determine it by brute force for any given transmission, based on the actual CRC. As expected, the IV did appear to be consistent between transmissions but change with each sensor reset, along with the rolling ID.</p>

<p>The key insight in figuring out how the CRC worked came when I noticed that even when the rolling ID changed, as long as the other data in the transmission remained constant, the CRC stayed the same. That could only mean that however the sensor was calculating the CRC, the rolling ID was not involved.</p>

<p>By calculating the CRC using nibbles 5 to 19, inclusive, <strong>but excluding the rolling ID nibbles</strong>, I found that the initial value could be assumed to be a constant, <code class="language-plaintext highlighter-rouge">0x42</code>. Perhaps there is an even simpler explanation than that, but, since this seems to work even when varying the rolling ID and changing the channel number, I’ll take it.</p>

<h1 id="prototype">Prototype</h1>

<figure class="medium">
  <img src="/assets/images/blog/2022-12-04/prototype_closeup.jpg" class="medium" />
  <figcaption>Left to right: USB logic analyzer, 433.92 MHz receiver, 433.92 MHz transmitter, DHT-22 temperature/humidity sensor, Arduino Leonardo</figcaption>
</figure>

<figure class="medium">
  <img src="/assets/images/blog/2022-12-04/prototype.jpg" class="medium" />
  <figcaption>1337 proof of successfully receiving an arbitrary transmission.</figcaption>
</figure>

<h1 id="whats-next">What’s next?</h1>

<p>The prototype proves that it works; my next step is to build a more practical sensor based on an ATTiny85 microcontroller, which will be much cheaper than a full-size Arduino board, use far less power, and fit in a tiny plastic case. I’ll link it here when it’s done. EDIT: <a href="/blog/2023/01/03/oregon-scientific-attiny85">ATtiny85-based Oregon Scientific v2.1 remote temperature sensor</a></p>

<h1 id="the-code">The code</h1>

<p><em>sensor.ino</em>:</p>

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><table class="rouge-line-table"><tbody><tr id="line-1" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>1</pre></td><td class="rouge-code"><pre><span class="cm">/*</span>
</pre></td></tr><tr id="line-2" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>2</pre></td><td class="rouge-code"><pre><span class="cm"> * Arduino-based temperature/humidity sensor compatible with the Oregon Scientific v2.1</span>
</pre></td></tr><tr id="line-3" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>3</pre></td><td class="rouge-code"><pre><span class="cm"> * 433.92 MHz weather sensor protocol.</span>
</pre></td></tr><tr id="line-4" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>4</pre></td><td class="rouge-code"><pre><span class="cm"> *</span>
</pre></td></tr><tr id="line-5" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>5</pre></td><td class="rouge-code"><pre><span class="cm"> * This sketch replicates the behaviour of the Oregon Scientific THGR122NX sensor.</span>
</pre></td></tr><tr id="line-6" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>6</pre></td><td class="rouge-code"><pre><span class="cm"> *</span>
</pre></td></tr><tr id="line-7" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>7</pre></td><td class="rouge-code"><pre><span class="cm"> * More info here: https://shumphries.ca/blog/2022/12/04/oregon-scientific</span>
</pre></td></tr><tr id="line-8" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>8</pre></td><td class="rouge-code"><pre><span class="cm"> *</span>
</pre></td></tr><tr id="line-9" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>9</pre></td><td class="rouge-code"><pre><span class="cm"> * LICENCE</span>
</pre></td></tr><tr id="line-10" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>10</pre></td><td class="rouge-code"><pre><span class="cm"> *</span>
</pre></td></tr><tr id="line-11" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>11</pre></td><td class="rouge-code"><pre><span class="cm"> * Copyright © 2022 Stephen Humphries</span>
</pre></td></tr><tr id="line-12" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>12</pre></td><td class="rouge-code"><pre><span class="cm"> *</span>
</pre></td></tr><tr id="line-13" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>13</pre></td><td class="rouge-code"><pre><span class="cm"> * Permission is hereby granted, free of charge, to any person obtaining a copy</span>
</pre></td></tr><tr id="line-14" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>14</pre></td><td class="rouge-code"><pre><span class="cm"> * of this software and associated documentation files (the "Software"), to deal</span>
</pre></td></tr><tr id="line-15" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>15</pre></td><td class="rouge-code"><pre><span class="cm"> * in the Software without restriction, including without limitation the rights</span>
</pre></td></tr><tr id="line-16" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>16</pre></td><td class="rouge-code"><pre><span class="cm"> * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
</pre></td></tr><tr id="line-17" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>17</pre></td><td class="rouge-code"><pre><span class="cm"> * copies of the Software, and to permit persons to whom the Software is</span>
</pre></td></tr><tr id="line-18" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>18</pre></td><td class="rouge-code"><pre><span class="cm"> * furnished to do so, subject to the following conditions:</span>
</pre></td></tr><tr id="line-19" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>19</pre></td><td class="rouge-code"><pre><span class="cm"> *</span>
</pre></td></tr><tr id="line-20" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>20</pre></td><td class="rouge-code"><pre><span class="cm"> * The above copyright notice and this permission notice shall be included in all</span>
</pre></td></tr><tr id="line-21" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>21</pre></td><td class="rouge-code"><pre><span class="cm"> * copies or substantial portions of the Software.</span>
</pre></td></tr><tr id="line-22" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>22</pre></td><td class="rouge-code"><pre><span class="cm"> *</span>
</pre></td></tr><tr id="line-23" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>23</pre></td><td class="rouge-code"><pre><span class="cm"> * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
</pre></td></tr><tr id="line-24" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>24</pre></td><td class="rouge-code"><pre><span class="cm"> * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
</pre></td></tr><tr id="line-25" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>25</pre></td><td class="rouge-code"><pre><span class="cm"> * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
</pre></td></tr><tr id="line-26" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>26</pre></td><td class="rouge-code"><pre><span class="cm"> * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
</pre></td></tr><tr id="line-27" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>27</pre></td><td class="rouge-code"><pre><span class="cm"> * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
</pre></td></tr><tr id="line-28" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>28</pre></td><td class="rouge-code"><pre><span class="cm"> * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE</span>
</pre></td></tr><tr id="line-29" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>29</pre></td><td class="rouge-code"><pre><span class="cm"> * SOFTWARE.</span>
</pre></td></tr><tr id="line-30" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>30</pre></td><td class="rouge-code"><pre><span class="cm"> */</span>
</pre></td></tr><tr id="line-31" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>31</pre></td><td class="rouge-code"><pre>
</pre></td></tr><tr id="line-32" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>32</pre></td><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">&lt;DHT.h&gt;</span><span class="c1"> // Adafruit's DHT sensor library (https://github.com/adafruit/DHT-sensor-library)</span>
</pre></td></tr><tr id="line-33" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>33</pre></td><td class="rouge-code"><pre>                 <span class="c1">// This library and/or the DHT-22 sensor can trivially be swapped out as required</span>
</pre></td></tr><tr id="line-34" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>34</pre></td><td class="rouge-code"><pre>
</pre></td></tr><tr id="line-35" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>35</pre></td><td class="rouge-code"><pre><span class="cp">#define DHT_PIN 2 // I/O for the temperature/humidity sensor</span>
</pre></td></tr><tr id="line-36" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>36</pre></td><td class="rouge-code"><pre><span class="cp">#define TX_PIN 3 // Output for the 433.92 Mhz modulator</span>
</pre></td></tr><tr id="line-37" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>37</pre></td><td class="rouge-code"><pre>
</pre></td></tr><tr id="line-38" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>38</pre></td><td class="rouge-code"><pre><span class="cp">#define SHORT 478 // Half of 1/1024 (which is about 488 us), but calibrated for real time (hardware dependent)</span>
</pre></td></tr><tr id="line-39" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>39</pre></td><td class="rouge-code"><pre>                  <span class="c1">// If you don't have an oscilloscope or logic analyzer handy, you could probably dial it in</span>
</pre></td></tr><tr id="line-40" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>40</pre></td><td class="rouge-code"><pre>                  <span class="c1">// by trying values from 470 to 500 or so</span>
</pre></td></tr><tr id="line-41" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>41</pre></td><td class="rouge-code"><pre>
</pre></td></tr><tr id="line-42" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>42</pre></td><td class="rouge-code"><pre><span class="cp">#define SUM_MASK 0xfffe0 // Only some nibbles are included in the checksum and CRC calculations</span>
</pre></td></tr><tr id="line-43" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>43</pre></td><td class="rouge-code"><pre><span class="cp">#define CRC_MASK 0xff3e0</span>
</pre></td></tr><tr id="line-44" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>44</pre></td><td class="rouge-code"><pre><span class="cp">#define CRC_IV 0x42 // ¯\_(ツ)_/¯ (see the blog post for details)</span>
</pre></td></tr><tr id="line-45" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>45</pre></td><td class="rouge-code"><pre><span class="cp">#define CRC_POLY 0x7 // CRC-8-CCITT</span>
</pre></td></tr><tr id="line-46" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>46</pre></td><td class="rouge-code"><pre>
</pre></td></tr><tr id="line-47" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>47</pre></td><td class="rouge-code"><pre><span class="c1">// Example transmission data</span>
</pre></td></tr><tr id="line-48" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>48</pre></td><td class="rouge-code"><pre><span class="c1">// - Bytes are transmitted in order, small nibble first</span>
</pre></td></tr><tr id="line-49" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>49</pre></td><td class="rouge-code"><pre><span class="c1">// - Nibbles are transmitted LSB-first</span>
</pre></td></tr><tr id="line-50" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>50</pre></td><td class="rouge-code"><pre><span class="c1">// - Nibble descritions in this example are large nibble first, to align with the byte-wise representation</span>
</pre></td></tr><tr id="line-51" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>51</pre></td><td class="rouge-code"><pre><span class="c1">// - Sensor ID 1d20, Channel 1, Rolling ID bb, Battery low, Temperature 22.7°C, Humidity 30%</span>
</pre></td></tr><tr id="line-52" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>52</pre></td><td class="rouge-code"><pre><span class="c1">// uint8_t data[] = {</span>
</pre></td></tr><tr id="line-53" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>53</pre></td><td class="rouge-code"><pre><span class="c1">//   0xff, // Preamble (16 ones (transmitted as 32 bits, alternating 01))</span>
</pre></td></tr><tr id="line-54" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>54</pre></td><td class="rouge-code"><pre><span class="c1">//   0xff, // Preamble</span>
</pre></td></tr><tr id="line-55" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>55</pre></td><td class="rouge-code"><pre><span class="c1">//   0x1a, // Sensor ID (1d20) / Sync (0xa)</span>
</pre></td></tr><tr id="line-56" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>56</pre></td><td class="rouge-code"><pre><span class="c1">//   0x2d, // Sensor ID</span>
</pre></td></tr><tr id="line-57" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>57</pre></td><td class="rouge-code"><pre><span class="c1">//   0x20, // Channel (1=0x1, 2=0x2, 3=0x4) / Sensor ID</span>
</pre></td></tr><tr id="line-58" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>58</pre></td><td class="rouge-code"><pre><span class="c1">//   0xbb, // Rolling ID (randomly generated on startup)</span>
</pre></td></tr><tr id="line-59" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>59</pre></td><td class="rouge-code"><pre><span class="c1">//   0x7c, // Temperature, 10^-1 / Battery low (low is 0x4, not low is 0x0, but both are often OR'd with a 0x8 bit of unknown significance)</span>
</pre></td></tr><tr id="line-60" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>60</pre></td><td class="rouge-code"><pre><span class="c1">//   0x22, // Temperature, 10^1 / Temperature, 10^0</span>
</pre></td></tr><tr id="line-61" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>61</pre></td><td class="rouge-code"><pre><span class="c1">//   0x00, // Humidity, 10^0 / Temperature sign (largest 2 bits, 0x0 for +ve, 0x8 for -ve) | Temperature 10^2 (smallest 2 bits)</span>
</pre></td></tr><tr id="line-62" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>62</pre></td><td class="rouge-code"><pre><span class="c1">//   0x83, // Unknown / Humidity, 10^1</span>
</pre></td></tr><tr id="line-63" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>63</pre></td><td class="rouge-code"><pre><span class="c1">//   0x4a, // Checksum (simple sum)</span>
</pre></td></tr><tr id="line-64" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>64</pre></td><td class="rouge-code"><pre><span class="c1">//   0x55, // Postamble (CRC checksum)</span>
</pre></td></tr><tr id="line-65" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>65</pre></td><td class="rouge-code"><pre><span class="c1">// };</span>
</pre></td></tr><tr id="line-66" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>66</pre></td><td class="rouge-code"><pre>
</pre></td></tr><tr id="line-67" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>67</pre></td><td class="rouge-code"><pre><span class="kt">uint8_t</span> <span class="n">data</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="c1">// Data frame, initialized with the parts that never change</span>
</pre></td></tr><tr id="line-68" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>68</pre></td><td class="rouge-code"><pre>  <span class="mh">0xff</span><span class="p">,</span>            <span class="c1">// Preamble</span>
</pre></td></tr><tr id="line-69" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>69</pre></td><td class="rouge-code"><pre>  <span class="mh">0xff</span><span class="p">,</span>
</pre></td></tr><tr id="line-70" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>70</pre></td><td class="rouge-code"><pre>  <span class="mh">0x1a</span><span class="p">,</span>            <span class="c1">// Sync nibble and sensor ID</span>
</pre></td></tr><tr id="line-71" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>71</pre></td><td class="rouge-code"><pre>  <span class="mh">0x2d</span><span class="p">,</span>
</pre></td></tr><tr id="line-72" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>72</pre></td><td class="rouge-code"><pre>  <span class="mh">0x00</span><span class="p">,</span>
</pre></td></tr><tr id="line-73" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>73</pre></td><td class="rouge-code"><pre>  <span class="mh">0x00</span><span class="p">,</span>
</pre></td></tr><tr id="line-74" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>74</pre></td><td class="rouge-code"><pre>  <span class="mh">0x08</span><span class="p">,</span>            <span class="c1">// Unknown</span>
</pre></td></tr><tr id="line-75" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>75</pre></td><td class="rouge-code"><pre>  <span class="mh">0x00</span><span class="p">,</span>
</pre></td></tr><tr id="line-76" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>76</pre></td><td class="rouge-code"><pre>  <span class="mh">0x00</span><span class="p">,</span>
</pre></td></tr><tr id="line-77" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>77</pre></td><td class="rouge-code"><pre>  <span class="mh">0x80</span><span class="p">,</span>            <span class="c1">// Unknown</span>
</pre></td></tr><tr id="line-78" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>78</pre></td><td class="rouge-code"><pre>  <span class="mh">0x00</span><span class="p">,</span>
</pre></td></tr><tr id="line-79" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>79</pre></td><td class="rouge-code"><pre>  <span class="mh">0x00</span><span class="p">,</span>
</pre></td></tr><tr id="line-80" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>80</pre></td><td class="rouge-code"><pre><span class="p">};</span>
</pre></td></tr><tr id="line-81" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>81</pre></td><td class="rouge-code"><pre><span class="kt">int</span> <span class="n">dataLen</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>
</pre></td></tr><tr id="line-82" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>82</pre></td><td class="rouge-code"><pre>
</pre></td></tr><tr id="line-83" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>83</pre></td><td class="rouge-code"><pre><span class="n">DHT</span> <span class="n">dht</span> <span class="o">=</span> <span class="n">DHT</span><span class="p">(</span><span class="n">DHT_PIN</span><span class="p">,</span> <span class="n">DHT22</span><span class="p">);</span>
</pre></td></tr><tr id="line-84" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>84</pre></td><td class="rouge-code"><pre>
</pre></td></tr><tr id="line-85" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>85</pre></td><td class="rouge-code"><pre><span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
</pre></td></tr><tr id="line-86" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>86</pre></td><td class="rouge-code"><pre>  <span class="n">dht</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
</pre></td></tr><tr id="line-87" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>87</pre></td><td class="rouge-code"><pre>
</pre></td></tr><tr id="line-88" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>88</pre></td><td class="rouge-code"><pre>  <span class="n">pinMode</span><span class="p">(</span><span class="n">TX_PIN</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
</pre></td></tr><tr id="line-89" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>89</pre></td><td class="rouge-code"><pre>  <span class="n">randomSeed</span><span class="p">(</span><span class="n">analogRead</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
</pre></td></tr><tr id="line-90" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>90</pre></td><td class="rouge-code"><pre>
</pre></td></tr><tr id="line-91" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>91</pre></td><td class="rouge-code"><pre>  <span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="mh">0x0f</span><span class="p">;</span> <span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">|=</span> <span class="p">((</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf0</span><span class="p">);</span> <span class="c1">// Channel, 1=0x1, 2=0x2, 3=0x4 // TODO: Read channel from pins?</span>
</pre></td></tr><tr id="line-92" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>92</pre></td><td class="rouge-code"><pre>  <span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="mh">0x00</span><span class="p">;</span> <span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">|=</span> <span class="p">(</span><span class="n">random</span><span class="p">(</span><span class="mi">256</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">);</span> <span class="c1">// Rolling ID</span>
</pre></td></tr><tr id="line-93" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>93</pre></td><td class="rouge-code"><pre><span class="p">}</span>
</pre></td></tr><tr id="line-94" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>94</pre></td><td class="rouge-code"><pre>
</pre></td></tr><tr id="line-95" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>95</pre></td><td class="rouge-code"><pre><span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
</pre></td></tr><tr id="line-96" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>96</pre></td><td class="rouge-code"><pre>  <span class="kt">float</span> <span class="n">t</span> <span class="o">=</span> <span class="n">dht</span><span class="p">.</span><span class="n">readTemperature</span><span class="p">();</span>
</pre></td></tr><tr id="line-97" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>97</pre></td><td class="rouge-code"><pre>  <span class="kt">uint8_t</span> <span class="n">t_sign</span> <span class="o">=</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">;</span>
</pre></td></tr><tr id="line-98" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>98</pre></td><td class="rouge-code"><pre>  <span class="kt">uint8_t</span> <span class="n">t_deci</span> <span class="o">=</span> <span class="p">((</span><span class="kt">int</span><span class="p">)(</span><span class="n">t</span> <span class="o">*</span> <span class="p">(</span><span class="n">t_sign</span> <span class="o">?</span> <span class="o">-</span><span class="mi">10</span> <span class="o">:</span> <span class="mi">10</span><span class="p">))</span> <span class="o">/</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">10</span><span class="p">;</span>
</pre></td></tr><tr id="line-99" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>99</pre></td><td class="rouge-code"><pre>  <span class="kt">uint8_t</span> <span class="n">t_ones</span> <span class="o">=</span> <span class="p">((</span><span class="kt">int</span><span class="p">)(</span><span class="n">t</span> <span class="o">*</span> <span class="p">(</span><span class="n">t_sign</span> <span class="o">?</span> <span class="o">-</span><span class="mi">10</span> <span class="o">:</span> <span class="mi">10</span><span class="p">))</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span> <span class="o">%</span> <span class="mi">10</span><span class="p">;</span>
</pre></td></tr><tr id="line-100" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>100</pre></td><td class="rouge-code"><pre>  <span class="kt">uint8_t</span> <span class="n">t_tens</span> <span class="o">=</span> <span class="p">((</span><span class="kt">int</span><span class="p">)(</span><span class="n">t</span> <span class="o">*</span> <span class="p">(</span><span class="n">t_sign</span> <span class="o">?</span> <span class="o">-</span><span class="mi">10</span> <span class="o">:</span> <span class="mi">10</span><span class="p">))</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span> <span class="o">%</span> <span class="mi">10</span><span class="p">;</span>
</pre></td></tr><tr id="line-101" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>101</pre></td><td class="rouge-code"><pre>  <span class="kt">uint8_t</span> <span class="n">t_huns</span> <span class="o">=</span> <span class="p">((</span><span class="kt">int</span><span class="p">)(</span><span class="n">t</span> <span class="o">*</span> <span class="p">(</span><span class="n">t_sign</span> <span class="o">?</span> <span class="o">-</span><span class="mi">10</span> <span class="o">:</span> <span class="mi">10</span><span class="p">))</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">%</span> <span class="mi">10</span><span class="p">;</span>
</pre></td></tr><tr id="line-102" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>102</pre></td><td class="rouge-code"><pre>
</pre></td></tr><tr id="line-103" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>103</pre></td><td class="rouge-code"><pre>  <span class="kt">float</span> <span class="n">h</span> <span class="o">=</span> <span class="n">dht</span><span class="p">.</span><span class="n">readHumidity</span><span class="p">()</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// Round to the nearest one by adding 0.5 then truncating the decimal</span>
</pre></td></tr><tr id="line-104" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>104</pre></td><td class="rouge-code"><pre>  <span class="kt">uint8_t</span> <span class="n">h_ones</span> <span class="o">=</span> <span class="p">((</span><span class="kt">int</span><span class="p">)(</span><span class="n">h</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span> <span class="o">%</span> <span class="mi">10</span><span class="p">;</span>
</pre></td></tr><tr id="line-105" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>105</pre></td><td class="rouge-code"><pre>  <span class="kt">uint8_t</span> <span class="n">h_tens</span> <span class="o">=</span> <span class="p">((</span><span class="kt">int</span><span class="p">)(</span><span class="n">h</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span> <span class="o">%</span> <span class="mi">10</span><span class="p">;</span>
</pre></td></tr><tr id="line-106" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>106</pre></td><td class="rouge-code"><pre>
</pre></td></tr><tr id="line-107" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>107</pre></td><td class="rouge-code"><pre>  <span class="c1">// data[6] &amp;= 0xf8; data[6] |= (lowBattery() ? 0x4 : 0x0); // Not implemented</span>
</pre></td></tr><tr id="line-108" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>108</pre></td><td class="rouge-code"><pre>
</pre></td></tr><tr id="line-109" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>109</pre></td><td class="rouge-code"><pre>  <span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="mh">0x0f</span><span class="p">;</span> <span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">|=</span> <span class="p">((</span><span class="n">t_deci</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf0</span><span class="p">);</span>
</pre></td></tr><tr id="line-110" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>110</pre></td><td class="rouge-code"><pre>  <span class="n">data</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="mh">0xf0</span><span class="p">;</span> <span class="n">data</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">|=</span> <span class="p">((</span><span class="n">t_ones</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x0f</span><span class="p">);</span>
</pre></td></tr><tr id="line-111" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>111</pre></td><td class="rouge-code"><pre>  <span class="n">data</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="mh">0x0f</span><span class="p">;</span> <span class="n">data</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">|=</span> <span class="p">((</span><span class="n">t_tens</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf0</span><span class="p">);</span>
</pre></td></tr><tr id="line-112" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>112</pre></td><td class="rouge-code"><pre>  <span class="n">data</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="mh">0xfc</span><span class="p">;</span> <span class="n">data</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">|=</span> <span class="p">((</span><span class="n">t_huns</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x03</span><span class="p">);</span>
</pre></td></tr><tr id="line-113" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>113</pre></td><td class="rouge-code"><pre>  <span class="n">data</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="mh">0xf3</span><span class="p">;</span> <span class="n">data</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">|=</span> <span class="p">((</span><span class="n">t_sign</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x0c</span><span class="p">);</span>
</pre></td></tr><tr id="line-114" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>114</pre></td><td class="rouge-code"><pre>
</pre></td></tr><tr id="line-115" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>115</pre></td><td class="rouge-code"><pre>  <span class="n">data</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="mh">0x0f</span><span class="p">;</span> <span class="n">data</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">|=</span> <span class="p">((</span><span class="n">h_ones</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf0</span><span class="p">);</span>
</pre></td></tr><tr id="line-116" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>116</pre></td><td class="rouge-code"><pre>  <span class="n">data</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="mh">0xf0</span><span class="p">;</span> <span class="n">data</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">|=</span> <span class="p">((</span><span class="n">h_tens</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x0f</span><span class="p">);</span>
</pre></td></tr><tr id="line-117" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>117</pre></td><td class="rouge-code"><pre>
</pre></td></tr><tr id="line-118" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>118</pre></td><td class="rouge-code"><pre>  <span class="n">data</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="mh">0x00</span><span class="p">;</span> <span class="n">data</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">|=</span> <span class="p">(</span><span class="n">checksumSimple</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">SUM_MASK</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">);</span>
</pre></td></tr><tr id="line-119" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>119</pre></td><td class="rouge-code"><pre>  <span class="n">data</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="mh">0x00</span><span class="p">;</span> <span class="n">data</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">|=</span> <span class="p">(</span><span class="n">checksumCRC</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">CRC_MASK</span><span class="p">,</span> <span class="n">CRC_IV</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">);</span>
</pre></td></tr><tr id="line-120" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>120</pre></td><td class="rouge-code"><pre>
</pre></td></tr><tr id="line-121" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>121</pre></td><td class="rouge-code"><pre>  <span class="n">sendData</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dataLen</span><span class="p">);</span>
</pre></td></tr><tr id="line-122" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>122</pre></td><td class="rouge-code"><pre>
</pre></td></tr><tr id="line-123" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>123</pre></td><td class="rouge-code"><pre>  <span class="n">delay</span><span class="p">(</span><span class="mi">40000</span><span class="p">);</span>
</pre></td></tr><tr id="line-124" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>124</pre></td><td class="rouge-code"><pre><span class="p">}</span>
</pre></td></tr><tr id="line-125" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>125</pre></td><td class="rouge-code"><pre>
</pre></td></tr><tr id="line-126" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>126</pre></td><td class="rouge-code"><pre>
</pre></td></tr><tr id="line-127" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>127</pre></td><td class="rouge-code"><pre><span class="kt">void</span> <span class="nf">sendData</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="n">data</span><span class="p">[],</span> <span class="kt">int</span> <span class="n">len</span><span class="p">)</span> <span class="p">{</span>
</pre></td></tr><tr id="line-128" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>128</pre></td><td class="rouge-code"><pre>  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Send the message twice</span>
</pre></td></tr><tr id="line-129" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>129</pre></td><td class="rouge-code"><pre>    <span class="n">cli</span><span class="p">();</span> <span class="c1">// Disable interrupts to avoid any timing funny business</span>
</pre></td></tr><tr id="line-130" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>130</pre></td><td class="rouge-code"><pre>    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">len</span> <span class="o">*</span> <span class="mi">8</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Bits are transmitted LSB-first</span>
</pre></td></tr><tr id="line-131" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>131</pre></td><td class="rouge-code"><pre>      <span class="n">sendBit</span><span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="n">j</span> <span class="o">/</span> <span class="mi">8</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="n">j</span> <span class="o">%</span> <span class="mi">8</span><span class="p">))</span> <span class="o">&amp;</span> <span class="mh">0x1</span><span class="p">);</span>
</pre></td></tr><tr id="line-132" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>132</pre></td><td class="rouge-code"><pre>    <span class="p">}</span>
</pre></td></tr><tr id="line-133" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>133</pre></td><td class="rouge-code"><pre>    <span class="n">digitalWrite</span><span class="p">(</span><span class="n">TX_PIN</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);</span> <span class="c1">// Don't leave the transmitter on!</span>
</pre></td></tr><tr id="line-134" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>134</pre></td><td class="rouge-code"><pre>    <span class="n">sei</span><span class="p">();</span> <span class="c1">// Re-enable interrupts</span>
</pre></td></tr><tr id="line-135" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>135</pre></td><td class="rouge-code"><pre>    <span class="n">delay</span><span class="p">(</span><span class="mi">55</span><span class="p">);</span> <span class="c1">// Pause for a short time between transmissions</span>
</pre></td></tr><tr id="line-136" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>136</pre></td><td class="rouge-code"><pre>  <span class="p">}</span>
</pre></td></tr><tr id="line-137" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>137</pre></td><td class="rouge-code"><pre><span class="p">}</span>
</pre></td></tr><tr id="line-138" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>138</pre></td><td class="rouge-code"><pre>
</pre></td></tr><tr id="line-139" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>139</pre></td><td class="rouge-code"><pre><span class="kt">void</span> <span class="nf">sendBit</span><span class="p">(</span><span class="kt">bool</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span>
</pre></td></tr><tr id="line-140" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>140</pre></td><td class="rouge-code"><pre>  <span class="k">if</span> <span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="p">{</span>
</pre></td></tr><tr id="line-141" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>141</pre></td><td class="rouge-code"><pre>    <span class="n">sendLowHigh</span><span class="p">();</span>
</pre></td></tr><tr id="line-142" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>142</pre></td><td class="rouge-code"><pre>    <span class="n">sendHighLow</span><span class="p">();</span> <span class="c1">// Doing it this way keeps the timing consistent, though</span>
</pre></td></tr><tr id="line-143" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>143</pre></td><td class="rouge-code"><pre>  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>         <span class="c1">// any difference is probably negligible</span>
</pre></td></tr><tr id="line-144" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>144</pre></td><td class="rouge-code"><pre>    <span class="n">sendHighLow</span><span class="p">();</span>
</pre></td></tr><tr id="line-145" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>145</pre></td><td class="rouge-code"><pre>    <span class="n">sendLowHigh</span><span class="p">();</span>
</pre></td></tr><tr id="line-146" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>146</pre></td><td class="rouge-code"><pre>  <span class="p">}</span>
</pre></td></tr><tr id="line-147" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>147</pre></td><td class="rouge-code"><pre><span class="p">}</span>
</pre></td></tr><tr id="line-148" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>148</pre></td><td class="rouge-code"><pre>
</pre></td></tr><tr id="line-149" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>149</pre></td><td class="rouge-code"><pre><span class="kt">void</span> <span class="nf">sendLowHigh</span><span class="p">()</span> <span class="p">{</span>
</pre></td></tr><tr id="line-150" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>150</pre></td><td class="rouge-code"><pre>  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">TX_PIN</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);</span>
</pre></td></tr><tr id="line-151" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>151</pre></td><td class="rouge-code"><pre>  <span class="n">delayMicroseconds</span><span class="p">(</span><span class="n">SHORT</span><span class="p">);</span>
</pre></td></tr><tr id="line-152" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>152</pre></td><td class="rouge-code"><pre>  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">TX_PIN</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
</pre></td></tr><tr id="line-153" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>153</pre></td><td class="rouge-code"><pre>  <span class="n">delayMicroseconds</span><span class="p">(</span><span class="n">SHORT</span><span class="p">);</span>
</pre></td></tr><tr id="line-154" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>154</pre></td><td class="rouge-code"><pre><span class="p">}</span>
</pre></td></tr><tr id="line-155" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>155</pre></td><td class="rouge-code"><pre>
</pre></td></tr><tr id="line-156" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>156</pre></td><td class="rouge-code"><pre><span class="kt">void</span> <span class="nf">sendHighLow</span><span class="p">()</span> <span class="p">{</span>
</pre></td></tr><tr id="line-157" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>157</pre></td><td class="rouge-code"><pre>  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">TX_PIN</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
</pre></td></tr><tr id="line-158" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>158</pre></td><td class="rouge-code"><pre>  <span class="n">delayMicroseconds</span><span class="p">(</span><span class="n">SHORT</span><span class="p">);</span>
</pre></td></tr><tr id="line-159" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>159</pre></td><td class="rouge-code"><pre>  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">TX_PIN</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);</span>
</pre></td></tr><tr id="line-160" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>160</pre></td><td class="rouge-code"><pre>  <span class="n">delayMicroseconds</span><span class="p">(</span><span class="n">SHORT</span><span class="p">);</span>
</pre></td></tr><tr id="line-161" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>161</pre></td><td class="rouge-code"><pre><span class="p">}</span>
</pre></td></tr><tr id="line-162" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>162</pre></td><td class="rouge-code"><pre>
</pre></td></tr><tr id="line-163" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>163</pre></td><td class="rouge-code"><pre><span class="kt">uint8_t</span> <span class="nf">checksumSimple</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="n">data</span><span class="p">[],</span> <span class="kt">uint64_t</span> <span class="n">mask</span><span class="p">)</span> <span class="p">{</span>
</pre></td></tr><tr id="line-164" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>164</pre></td><td class="rouge-code"><pre>  <span class="kt">uint16_t</span> <span class="n">s</span> <span class="o">=</span> <span class="mh">0x0000</span><span class="p">;</span>
</pre></td></tr><tr id="line-165" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>165</pre></td><td class="rouge-code"><pre>
</pre></td></tr><tr id="line-166" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>166</pre></td><td class="rouge-code"><pre>  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">64</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
</pre></td></tr><tr id="line-167" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>167</pre></td><td class="rouge-code"><pre>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">((</span><span class="n">mask</span> <span class="o">&gt;&gt;</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x1</span><span class="p">))</span> <span class="k">continue</span><span class="p">;</span> <span class="c1">// Skip nibbles that aren't set in the mask</span>
</pre></td></tr><tr id="line-168" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>168</pre></td><td class="rouge-code"><pre>
</pre></td></tr><tr id="line-169" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>169</pre></td><td class="rouge-code"><pre>    <span class="n">s</span> <span class="o">+=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="p">((</span><span class="n">i</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4</span><span class="p">))</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span> <span class="c1">// Sum data nibble by nibble</span>
</pre></td></tr><tr id="line-170" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>170</pre></td><td class="rouge-code"><pre>    <span class="n">s</span> <span class="o">+=</span> <span class="p">(</span><span class="n">s</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x1</span><span class="p">;</span> <span class="c1">// Add any overflow back into the sum</span>
</pre></td></tr><tr id="line-171" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>171</pre></td><td class="rouge-code"><pre>    <span class="n">s</span> <span class="o">&amp;=</span> <span class="mh">0xff</span><span class="p">;</span>
</pre></td></tr><tr id="line-172" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>172</pre></td><td class="rouge-code"><pre>  <span class="p">}</span>
</pre></td></tr><tr id="line-173" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>173</pre></td><td class="rouge-code"><pre>
</pre></td></tr><tr id="line-174" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>174</pre></td><td class="rouge-code"><pre>  <span class="k">return</span> <span class="n">s</span><span class="p">;</span>
</pre></td></tr><tr id="line-175" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>175</pre></td><td class="rouge-code"><pre><span class="p">}</span>
</pre></td></tr><tr id="line-176" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>176</pre></td><td class="rouge-code"><pre>
</pre></td></tr><tr id="line-177" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>177</pre></td><td class="rouge-code"><pre><span class="kt">uint8_t</span> <span class="nf">checksumCRC</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="n">data</span><span class="p">[],</span> <span class="kt">uint64_t</span> <span class="n">mask</span><span class="p">,</span> <span class="kt">uint8_t</span> <span class="n">iv</span><span class="p">)</span> <span class="p">{</span>
</pre></td></tr><tr id="line-178" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>178</pre></td><td class="rouge-code"><pre>  <span class="kt">uint16_t</span> <span class="n">s</span> <span class="o">=</span> <span class="n">iv</span><span class="p">;</span>
</pre></td></tr><tr id="line-179" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>179</pre></td><td class="rouge-code"><pre>
</pre></td></tr><tr id="line-180" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>180</pre></td><td class="rouge-code"><pre>  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">64</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
</pre></td></tr><tr id="line-181" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>181</pre></td><td class="rouge-code"><pre>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">((</span><span class="n">mask</span> <span class="o">&gt;&gt;</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x1</span><span class="p">))</span> <span class="k">continue</span><span class="p">;</span> <span class="c1">// Skip nibbles that aren't set in the mask</span>
</pre></td></tr><tr id="line-182" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>182</pre></td><td class="rouge-code"><pre>
</pre></td></tr><tr id="line-183" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>183</pre></td><td class="rouge-code"><pre>    <span class="kt">uint8_t</span> <span class="n">nibble</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="p">((</span><span class="n">i</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4</span><span class="p">))</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>
</pre></td></tr><tr id="line-184" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>184</pre></td><td class="rouge-code"><pre>
</pre></td></tr><tr id="line-185" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>185</pre></td><td class="rouge-code"><pre>    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="n">j</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="o">--</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
</pre></td></tr><tr id="line-186" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>186</pre></td><td class="rouge-code"><pre>      <span class="kt">uint8_t</span> <span class="n">bit</span> <span class="o">=</span> <span class="p">(</span><span class="n">nibble</span> <span class="o">&gt;&gt;</span> <span class="n">j</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x1</span><span class="p">;</span>
</pre></td></tr><tr id="line-187" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>187</pre></td><td class="rouge-code"><pre>
</pre></td></tr><tr id="line-188" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>188</pre></td><td class="rouge-code"><pre>      <span class="n">s</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span><span class="p">;</span>
</pre></td></tr><tr id="line-189" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>189</pre></td><td class="rouge-code"><pre>      <span class="n">s</span> <span class="o">|=</span> <span class="n">bit</span><span class="p">;</span>
</pre></td></tr><tr id="line-190" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>190</pre></td><td class="rouge-code"><pre>
</pre></td></tr><tr id="line-191" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>191</pre></td><td class="rouge-code"><pre>      <span class="k">if</span> <span class="p">(</span><span class="n">s</span> <span class="o">&amp;</span> <span class="mh">0x100</span><span class="p">)</span> <span class="p">{</span>
</pre></td></tr><tr id="line-192" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>192</pre></td><td class="rouge-code"><pre>        <span class="n">s</span> <span class="o">^=</span> <span class="n">CRC_POLY</span><span class="p">;</span>
</pre></td></tr><tr id="line-193" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>193</pre></td><td class="rouge-code"><pre>      <span class="p">}</span>
</pre></td></tr><tr id="line-194" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>194</pre></td><td class="rouge-code"><pre>    <span class="p">}</span>
</pre></td></tr><tr id="line-195" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>195</pre></td><td class="rouge-code"><pre>  <span class="p">}</span>
</pre></td></tr><tr id="line-196" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>196</pre></td><td class="rouge-code"><pre>
</pre></td></tr><tr id="line-197" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>197</pre></td><td class="rouge-code"><pre>  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
</pre></td></tr><tr id="line-198" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>198</pre></td><td class="rouge-code"><pre>    <span class="n">s</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span><span class="p">;</span>
</pre></td></tr><tr id="line-199" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>199</pre></td><td class="rouge-code"><pre>    <span class="k">if</span> <span class="p">(</span><span class="n">s</span> <span class="o">&amp;</span> <span class="mh">0x100</span><span class="p">)</span> <span class="p">{</span>
</pre></td></tr><tr id="line-200" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>200</pre></td><td class="rouge-code"><pre>      <span class="n">s</span> <span class="o">^=</span> <span class="n">CRC_POLY</span><span class="p">;</span>
</pre></td></tr><tr id="line-201" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>201</pre></td><td class="rouge-code"><pre>    <span class="p">}</span>
</pre></td></tr><tr id="line-202" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>202</pre></td><td class="rouge-code"><pre>  <span class="p">}</span>
</pre></td></tr><tr id="line-203" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>203</pre></td><td class="rouge-code"><pre>
</pre></td></tr><tr id="line-204" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>204</pre></td><td class="rouge-code"><pre>  <span class="k">return</span> <span class="n">s</span><span class="p">;</span>
</pre></td></tr><tr id="line-205" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>205</pre></td><td class="rouge-code"><pre><span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></figure>


</section>

<div class="source-edit-history">
  <a href="https://github.com/sjahu/sjahu.github.io/blob/main/blog/_posts/2022-12-04-oregon-scientific.md?plain=1">Source</a>&nbsp;
  <a href="https://github.com/sjahu/sjahu.github.io/edit/main/blog/_posts/2022-12-04-oregon-scientific.md">Edit</a>&nbsp;
  <a href="https://github.com/sjahu/sjahu.github.io/commits/main/blog/_posts/2022-12-04-oregon-scientific.md">History</a>
</div>

    </div>

    <div id="default-footer">
      
      <footer>
        <div><small>Copyright &copy; 2023 Stephen Humphries</small></div>
        <div><small>PGP: 6CF3&nbsp;3595&nbsp;1E54&nbsp;1ED2&nbsp;3C66&nbsp;1444&nbsp;CEDA&nbsp;0AA8&nbsp;3DE2&nbsp;A2CB</small></div>
      </footer>
      
    </div>
  </div>
</body>

</html>
